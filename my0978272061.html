<!DOCTYPE html>
<html lang="am">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BEKAS FAST - PRIVATE ADMIN</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <style>
        html, body { max-width: 100%; overflow-x: hidden; margin: 0; padding: 0; background: #f0f2f5; font-family: sans-serif; }
        .header { background: #ffcc00; padding: 15px; text-align: center; font-weight: 900; font-size: 18px; border-bottom: 3px solid #000; position: sticky; top: 0; }
        .section { background: white; margin: 10px; border: 2px solid #000; border-radius: 4px; }
        .section-title { background: #002d4b; color: white; padding: 10px; font-size: 13px; font-weight: bold; }
        table { width: 100%; border-collapse: collapse; }
        td { padding: 12px 6px; border-bottom: 1px solid #ddd; vertical-align: middle; }
        .phone-num { font-size: 18px; font-weight: 900; color: #000; display: block; }
        .money-txt { color: #d9534f; font-weight: 900; font-size: 14px; }
        .req-txt { color: #007bff; font-weight: bold; font-size: 12px; }
        .box { width: 65px; padding: 7px 4px; border: 2px solid #000; font-size: 13px; font-weight: bold; }
        .btn { padding: 8px 6px; border: none; border-radius: 2px; color: white; cursor: pointer; font-weight: bold; font-size: 11px; }
        .btn-green { background: #00b050; }
        .btn-blue { background: #007bff; }
        .btn-red { background: #ff0000; }
        .row { display: flex; align-items: center; gap: 5px; margin-top: 5px; }
    </style>
</head>
<body>

<div class="header">BEKAS FAST - PRIVATE ADMIN</div>

<div class="section">
    <div class="section-title">የይለፍ ቃል ጥያቄዎች (SMS REQUESTS)</div>
    <table>
        <tbody id="req-body"></tbody>
    </table>
</div>

<div class="section">
    <div class="section-title">የገንዘብ ጥያቄዎች (TRANS)</div>
    <table>
        <tbody id="trans-body"></tbody>
    </table>
</div>

<div class="section">
    <div class="section-title">ተጠቃሚዎች (USERS)</div>
    <table>
        <tbody id="users-body"></tbody>
    </table>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyAApcQQ3XySdQ6YG4wnrTUPnm0wZB078QQ",
        authDomain: "bekas-fast-d2a3b.firebaseapp.com",
        databaseURL: "https://bekas-fast-d2a3b-default-rtdb.firebaseio.com",
        projectId: "bekas-fast-d2a3b",
        storageBucket: "bekas-fast-d2a3b.firebasestorage.app",
        messagingSenderId: "130702344830",
        appId: "1:130702344830:web:58577289ec2f3208a64e2f"
    };
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    // 1. የይለፍ ቃል ጥያቄዎችን አሳይ
    database.ref('password_requests').on('value', (snap) => {
        const body = document.getElementById('req-body');
        body.innerHTML = "";
        snap.forEach((child) => {
            const r = child.val();
            body.innerHTML += `<tr>
                <td><b class="phone-num">${r.phone}</b><span class="req-txt">የድሮ ፓስወርድ ጠይቋል</span></td>
                <td><button class="btn btn-red" onclick="removeData('password_requests/${child.key}')">DEL</button></td>
            </tr>`;
        });
    });

    // 2. የገንዘብ ጥያቄዎች
    database.ref().on('value', (s) => {
        const body = document.getElementById('trans-body');
        body.innerHTML = "";
        const process = (snap, type) => {
            snap.forEach(c => {
                const d = c.val();
                body.innerHTML += `<tr>
                    <td style="width:70%"><b class="phone-num">${d.phone}</b><span>${type}: ${d.transactionCode || ''}</span></td>
                    <td style="color:${type==='DEP'?'green':'red'}; font-weight:bold;">${d.amount}</td>
                    <td><button class="btn btn-red" onclick="removeData('${type==='DEP'?'deposits':'withdrawals'}/${c.key}')">DEL</button></td>
                </tr>`;
            });
        };
        process(s.child('deposits'), 'DEP');
        process(s.child('withdrawals'), 'WITH');
    });

    // 3. ተጠቃሚዎች
    database.ref('users').on('value', (snap) => {
        const body = document.getElementById('users-body');
        body.innerHTML = "";
        snap.forEach((child) => {
            const u = child.val();
            const id = child.key;
            body.innerHTML += `<tr>
                <td>
                    <b class="phone-num">${id}</b>
                    <span class="money-txt">${u.balance || 0} ETB</span>
                    <span style="display:block; font-size:12px; color:blue;">PASS: ${u.password}</span>
                </td>
                <td>
                    <div class="row">
                        <input type="number" id="bal-${id}" class="box" placeholder="ብር" oninput="if(this.value.length>5)this.value=this.value.slice(0,5)">
                        <button class="btn btn-green" onclick="updateBal('${id}')">OK</button>
                    </div>
                    <div class="row">
                        <input type="number" id="pass-${id}" class="box" placeholder="PIN" oninput="if(this.value.length>5)this.value=this.value.slice(0,5)">
                        <button class="btn btn-blue" onclick="changePass('${id}')">PIN</button>
                    </div>
                </td>
            </tr>`;
        });
    });

    function updateBal(id) {
        const amt = parseFloat(document.getElementById('bal-' + id).value);
        if (amt >= 10) {
            database.ref('users/' + id + '/balance').transaction(c => (c || 0) + amt);
            document.getElementById('bal-' + id).value = "";
        }
    }

    function changePass(id) {
        const p = document.getElementById('pass-' + id).value;
        if (p.length === 5) {
            database.ref('users/' + id + '/password').set(p);
            document.getElementById('pass-' + id).value = "";
            alert("ተቀይሯል");
        }
    }

    function removeData(path) {
        if(confirm("ይጥፋ?")) database.ref(path).remove();
    }
</script>
</body>
</html>
