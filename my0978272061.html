<!DOCTYPE html>
<html lang="am">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BEKAS FAST - CONTROL</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <style>
        html, body { max-width: 100%; overflow-x: hidden; margin: 0; padding: 0; background: #f0f2f5; font-family: sans-serif; }
        body { display: block; min-height: 100vh; padding-bottom: 30px; }
        .header { background: #ffcc00; padding: 15px; text-align: center; font-weight: 900; font-size: 18px; border-bottom: 3px solid #000; position: sticky; top: 0; z-index: 1000; }
        
        .section { background: white; margin: 10px; border: 2px solid #000; border-radius: 4px; }
        .section-title { background: #002d4b; color: white; padding: 10px; font-size: 13px; font-weight: bold; }
        
        table { width: 100%; border-collapse: collapse; }
        td { padding: 12px 6px; border-bottom: 1px solid #ddd; vertical-align: middle; }
        
        .phone-num { font-size: 18px; font-weight: 900; color: #000; display: block; }
        .user-info { font-size: 12px; color: #555; }
        .money-txt { color: #d9534f; font-weight: 900; font-size: 14px; }
        .user-pass-label { color: #007bff; font-weight: bold; font-size: 13px; display: block; margin-top: 2px; border: 1px solid #007bff; padding: 2px; width: fit-content; border-radius: 3px; }

        .action-container { display: flex; flex-direction: column; gap: 8px; }
        .row { display: flex; align-items: center; gap: 5px; }
        
        .box { width: 65px; padding: 7px 4px; border: 2px solid #000; font-size: 13px; font-weight: bold; outline: none; }
        
        .btn { padding: 8px 6px; border: none; border-radius: 2px; color: white; cursor: pointer; font-weight: bold; font-size: 11px; text-align: center; }
        .btn-green { background: #00b050; flex: 1; }
        .btn-blue { background: #007bff; flex: 1; }
        .btn-red { background: #ff0000; font-size: 10px; padding: 8px 4px; }

        .label-sm { font-size: 10px; color: #777; display: block; }
    </style>
</head>
<body>

<div class="header">BEKAS FAST - PRIVATE ADMIN</div>

<div class="section">
    <div class="section-title">የገንዘብ ጥያቄዎች (DEPOSIT/WITHDRAW)</div>
    <table>
        <tbody id="trans-body"></tbody>
    </table>
</div>

<div class="section">
    <div class="section-title">ተጠቃሚዎች (USER MANAGEMENT)</div>
    <table>
        <tbody id="users-body"></tbody>
    </table>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyAApcQQ3XySdQ6YG4wnrTUPnm0wZB078QQ",
        authDomain: "bekas-fast-d2a3b.firebaseapp.com",
        databaseURL: "https://bekas-fast-d2a3b-default-rtdb.firebaseio.com",
        projectId: "bekas-fast-d2a3b",
        storageBucket: "bekas-fast-d2a3b.firebasestorage.app",
        messagingSenderId: "130702344830",
        appId: "1:130702344830:web:58577289ec2f3208a64e2f"
    };
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    // ጥያቄዎችን ማሳያ
    database.ref().on('value', (s) => {
        const body = document.getElementById('trans-body');
        body.innerHTML = "";
        const process = (snap, type) => {
            snap.forEach(c => {
                const d = c.val();
                body.innerHTML += `<tr>
                    <td style="width:70%"><b class="phone-num">${d.phone}</b><span class="label-sm">${type}: ${d.transactionCode || ''}</span></td>
                    <td style="color:${type==='DEP'?'green':'red'}; font-weight:bold;">${type==='DEP'?'+':'-'}${d.amount}</td>
                    <td><button class="btn btn-red" onclick="removeData('${type==='DEP'?'deposits':'withdrawals'}/${c.key}')">DEL</button></td>
                </tr>`;
            });
        };
        process(s.child('deposits'), 'DEP');
        process(s.child('withdrawals'), 'WITH');
    });

    // ተጠቃሚዎችን ማሳያ
    database.ref('users').on('value', (snap) => {
        const body = document.getElementById('users-body');
        body.innerHTML = "";
        snap.forEach((child) => {
            const u = child.val();
            const id = child.key;
            body.innerHTML += `
            <tr>
                <td style="width: 45%;">
                    <span class="user-info">${u.username}</span>
                    <b class="phone-num">${id}</b>
                    <span class="money-txt">${u.balance || 0} ETB</span>
                    <span class="user-pass-label">PASS: ${u.password}</span>
                </td>
                <td style="width: 55%;">
                    <div class="action-container">
                        <div class="row">
                            <input type="number" id="bal-${id}" class="box" placeholder="ብር" oninput="limitLen(this, 5)">
                            <button class="btn btn-green" onclick="updateBal('${id}')">OK</button>
                        </div>
                        <div class="row">
                            <input type="number" id="pass-${id}" class="box" placeholder="PIN" oninput="limitLen(this, 5)">
                            <button class="btn btn-blue" onclick="changePass('${id}')">PIN</button>
                            <button class="btn btn-red" onclick="deleteUser('${id}')">DELETE</button>
                        </div>
                    </div>
                </td>
            </tr>`;
        });
    });

    function limitLen(el, max) {
        if (el.value.length > max) el.value = el.value.slice(0, max);
    }

    function updateBal(id) {
        const amt = parseFloat(document.getElementById('bal-' + id).value);
        if (amt >= 10) {
            database.ref('users/' + id + '/balance').transaction(c => (c || 0) + amt);
            document.getElementById('bal-' + id).value = "";
        } else { alert("ቢያንስ 10 ብር!"); }
    }

    function changePass(id) {
        const p = document.getElementById('pass-' + id).value;
        if (p.length === 5) {
            database.ref('users/' + id + '/password').set(p);
            document.getElementById('pass-' + id).value = "";
            alert("ፓስወርድ ተቀይሯል!");
        } else { alert("5 ቁጥር መሆን አለበት!"); }
    }

    function deleteUser(id) {
        if(confirm("ይህ አካውንት ይጥፋ?")) database.ref('users/' + id).remove();
    }

    function removeData(path) {
        if(confirm("ይህ ጥያቄ ይጥፋ?")) database.ref(path).remove();
    }
</script>
</body>
</html>